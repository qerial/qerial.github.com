<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Crypto Visualizer + Price Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: #121212;
      font-family: Arial, sans-serif;
      color: white;
      overflow: hidden;
    }

    header {
      padding: 10px 20px;
      background: #1e1e1e;
      text-align: center;
      font-size: 24px;
      font-weight: bold;
    }

    #main {
      display: flex;
      height: calc(100vh - 60px);
    }

    #scene-container {
      flex: 2;
      position: relative;
    }

    #price-panel {
      flex: 1;
      background: #1a1a1a;
      overflow-y: auto;
      padding: 20px;
    }

    .coin-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .coin-row span:first-child {
      font-weight: bold;
      text-transform: capitalize;
    }

    .price {
      color: #7cdbb6;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    #overlay-price {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.6);
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 18px;
    }
  </style>
</head>
<body>

  <header>Crypto 3D Visualizer + Live Prices</header>

  <div id="main">
    <div id="scene-container">
      <div id="overlay-price">Loading BTC price...</div>
    </div>
    <div id="price-panel">
      <h2>Live Prices</h2>
      <div id="price-list">Loading...</div>
    </div>
  </div>

  <!-- Three.js + OrbitControls -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.155.0/examples/js/controls/OrbitControls.js"></script>

  <script>
    // Setup 3D scene
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x111111);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth * 2/3 / window.innerHeight, 0.1, 1000);
    camera.position.set(0, 2, 5);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    const container = document.getElementById('scene-container');
    renderer.setSize(container.clientWidth, container.clientHeight);
    container.appendChild(renderer.domElement);

    // Lights
    scene.add(new THREE.AmbientLight(0xffffff, 0.6));
    const pointLight = new THREE.PointLight(0xffffff, 0.8);
    pointLight.position.set(5, 5, 5);
    scene.add(pointLight);

    // Orbit controls
    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // Create coin
    const radius = 1;
    const thickness = 0.15;
    const segments = 64;
    const geometry = new THREE.CylinderGeometry(radius, radius, thickness, segments);

    const textureLoader = new THREE.TextureLoader();
    const coinTexture = textureLoader.load('https://i.imgur.com/0Kfb0fL.png'); // You can change this to another coin image

    const material = new THREE.MeshStandardMaterial({
      map: coinTexture,
      metalness: 0.8,
      roughness: 0.2
    });

    const coin = new THREE.Mesh(geometry, material);
    coin.rotation.x = Math.PI / 2;
    scene.add(coin);

    // Animate
    function animate() {
      requestAnimationFrame(animate);
      coin.rotation.z += 0.01;
      controls.update();
      renderer.render(scene, camera);
    }

    animate();

    // Handle resize
    window.addEventListener('resize', () => {
      camera.aspect = container.clientWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(container.clientWidth, window.innerHeight);
    });

    // Price fetching logic
    const overlayPrice = document.getElementById("overlay-price");
    const priceList = document.getElementById("price-list");
    const trackedCoins = ["bitcoin", "ethereum", "litecoin", "dogecoin", "solana"];

    async function fetchPrices() {
      try {
        const ids = trackedCoins.join(',');
        const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${ids}&vs_currencies=usd`);
        const data = await response.json();

        // Update overlay BTC price
        const btc = data.bitcoin?.usd;
        if (btc) {
          overlayPrice.textContent = `BTC: $${btc.toLocaleString()}`;
        }

        // Update side panel
        priceList.innerHTML = '';
        trackedCoins.forEach(coin => {
          const price = data[coin]?.usd;
          if (price) {
            const row = document.createElement('div');
            row.className = 'coin-row';
            row.innerHTML = `<span>${coin}</span><span class="price">$${price.toLocaleString()}</span>`;
            priceList.appendChild(row);
          }
        });

      } catch (err) {
        overlayPrice.textContent = "Failed to fetch prices.";
        console.error(err);
      }
    }

    // Start fetching
    fetchPrices();
    setInterval(fetchPrices, 10000); // every 10 seconds
  </script>
</body>
</html>
